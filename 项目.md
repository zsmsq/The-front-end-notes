# 1- 预览项目

* atguigu.zpi解压缩

* 进入到该项目目录

* 安装依赖

  ```shell
  yarn
  ```

* 启动项目

  ```shell
  npm start
  yarn start
  cnpm start
  ```

* 更改hosts文件:C:\Windows\System32\drivers\etc\hosts

  ```shell
  127.0.0.1 atguigu.com
  127.0.0.1 zhangpeiyue.com
  127.0.0.1 lisii.com
  127.0.0.1 api.zhangpeiyue.com
  127.0.0.1 zhangsan.com
  ```

* 输入账号密码

  ```shell
  账号：admin
  密码：111111
  ```

* 淘宝镜像设置

  * 检查

    ```shell
    npm config get registry
    ```

    

  * 设置

    ```shell
    npm config set registry https://registry.npm.taobao.org
    ```

* 安装yarn

  ```shell
  cnpm install yarn -g
  ```

  

# 2- 创建基于TS的脚手架项目

* 命令: 创建一个名字为first有基于TS语言的脚手架项目

  ```shell
  npx create-react-app first --template typescript
  ```

>  注意： 1- 不要在创建项目的目录中出现中文。
>
> 注意：  2-` VSCODE`当中只允许出现你的项目。

# 3- 设置网站标题以及站标

* 将public中除index.html以外全部删除

* public->index.html

  ```html
  <!DOCTYPE html>
  <html lang="en">
    <head>
      <meta charset="utf-8" />
      <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
      <meta name="viewport" content="width=device-width, initial-scale=1" />
      <meta name="theme-color" content="#000000" />
      <meta
        name="description"
        content="Web site created using create-react-app"
      />
  
      <title>尚医通后台管理系统</title>
    </head>
    <body>
      <noscript>You need to enable JavaScript to run this app.</noscript>
      <div id="root"></div>
    </body>
  </html>
  
  ```

* 将站标图片放置到public目录中即可

# 4- 在脚手架中使用函数组件

> 在项目中的ts文件中一旦出现JSX语法，必须要将扩展名设置为.tsx

* src目录内容清空

* src->index.tsx

  ```tsx
  // 以.tsx结尾的文件会用到ts,以及jsx语法
  // 以.ts结尾的文件会用到ts语法
  // react是可以帮助程序员构建用户界面的JAVASCRIPT
  import React from "react";
  import ReactDOM from "react-dom/client";
  import App from "./App";
  // 1- 指定挂载的位置
  const root = ReactDOM.createRoot(document.querySelector("#root") as Element);
  
  // 2:指定挂载的内容:
  // 2-1:在当前文件中创建函数组件
  // function App (){
  //     return (
  //         <div>App</div>
  //     )
  // }
  
  // 2-2:将函数组件赋值给常量
  // const App = ()=> (
  //     <div>App2</div>
  // )
  
  // 2-3:属性的类型  typescript--->anyscript
  // function App(props:any){
  //     return (
  //         <div>
  //             <p>userName:{props.userName}</p>
  //             <p>age:{props.age}</p>
  //         </div>
  //     )
  // }
  
  // 2-4:指定类型->interface
  // interface IProps {
  //     userName:string,
  //     age:number
  // }
  // function App(props:IProps){
  //     return (
  //         <div>
  //             <p>userName:{props.userName}</p>
  //             <p>age:{props.age}</p>
  //         </div>
  //     )
  // }
  
  // 2-5:指定类型->type
  // const userName:string = "zhangsan";
  // const info:string | number = "12";
  // const a:string | number = 12;
  // type TOne  = string | number;
  // const b:TOne = "A";
  // const c:TOne = 12;
  
  // interface IPerson {
  //     userName:string
  // }
  // interface IBox extends IPerson{
  //     age:number
  // }
  // const a:IBox = {
  //     age:12,
  //     userName:"zhangSan"
  // }
  
  // type TPerson = {
  //     age:number
  // }
  // type TBox = {
  //     userName:string
  // } & TPerson;
  // const a :TBox = {
  //     userName:"lisi",
  //     age:12
  // }
  
  // interface IOne  {
  //     userName:string
  // }
  // interface IOne {
  //     age:number
  // }
  // const a : IOne = {
  //     userName:"zhangsan",
  //     age:12
  // }
  
  
  // type TProps = {
  //     userName:string,
  //     age:number
  // }
  // function App(props:TProps){
  //     return (
  //         <div>
  //             <p>userName:{props.userName}</p>
  //             <p>age:{props.age}</p>
  //         </div>
  //     )
  // }
  
  
  // 2-6:约束类型1
  // type TProps = {
  //     userName:string,
  //     age:number
  // }
  // const App:React.FC<TProps> = props => (
  //     <div>
  //         <p>userName:{props.userName}</p>
  //         <p>age:{props.age}</p>
  //     </div>
  // )
  
  // 2-7 约束 类型
  // const App:React.FC<{userName:string,age:number}> = props => (
  //     <div>
  //         <p>userName:{props.userName}</p>
  //         <p>age:{props.age}</p>
  //     </div>
  // )
  
  // 2-8 将组件定义在外部
  
  
  // 3- 将App呈现到界面中
  root.render(<App userName={"lisi"} age={12}/>);
  
  ```

* src->App.tsx

  ```tsx
  import React from 'react';
  
  function App(props:{userName:string,age:number}) {
      return (
          <div>
              <p>userName:{props.userName}</p>
              <p>age:{props.age}</p>
          </div>
      );
  }
  
  export default App;
  ```

# 5- 二次配置--配置服务

* 下载依赖的第三方模块@craco/craco

  ```shell
  cnpm install @craco/craco
  ```

* 修改pageage.json

  ```json
  /* package.json */
  
  "scripts": {
  -   "start": "react-scripts start",
  +   "start": "craco start",
  -   "build": "react-scripts build",
  +   "build": "craco build"
  -   "test": "react-scripts test",
  +   "test": "craco test"
  }
  ```

  

* 项目根目录中创建一个名字为 `craco.config.js`的文件

  ```tsx
  // 可以在该文件中对webpack进行二次配置。
  module.exports = {
      devServer:{
          port:80,// 将默认3000端口号设置为80
          host:"zhangpeiyue.com",// 将localhost--->zhangpeiyue.com 指定主机名 ip  域名
      }
  }
  ```

* 重启项目

  ```shell
  yarn start
  ```

# 6- 二次配置--配置别名

* 项目根目录->craco.config.js

  ```js
  // 可以在该文件中对webpack进行二次配置。
  const path = require("path");
  module.exports = {
      webpack:{
          // 1-别名处理：属性名即是别名：值是别名对应的目录
          alias:{
              "@":path.resolve(__dirname,"./src")
          }
      },
      devServer:{
          port:80,// 将默认3000端口号设置为80
          host:"zhangpeiyue.com",// 将localhost--->zhangpeiyue.com 指定主机名 ip  域名
      }
  }
  ```

* 方案一：项目根目录->tsconfig.json

  ```json
  {
    "compilerOptions": {
      "target": "es5",
      "paths": {
        "@/*":["./src/*"]
      },
      "lib": [
        "dom",
        "dom.iterable",
        "esnext"
      ],
      "allowJs": true,
      "skipLibCheck": true,
      "esModuleInterop": true,
      "allowSyntheticDefaultImports": true,
      "strict": true,
      "forceConsistentCasingInFileNames": true,
      "noFallthroughCasesInSwitch": true,
      "module": "esnext",
      "moduleResolution": "node",
      "resolveJsonModule": true,
      "isolatedModules": true,
      "noEmit": true,
      "jsx": "react-jsx"
    },
    "include": [
      "src"
    ]
  }
  
  ```

* 方案二

  * 项目根目录中创建一个名字为`path.tsconfig.json`

    ```json
    {
        "compilerOptions": {
            "paths": {
                "@/*":["./src/*"]
            }
        }
    }
    ```

  *  项目根目录中的tsconfig.json

    ```json
    {
      "extends": "./path.tsconfig.json",
      "compilerOptions": {
        "target": "es5",
        "lib": [
          "dom",
          "dom.iterable",
          "esnext"
        ],
        "allowJs": true,
        "skipLibCheck": true,
        "esModuleInterop": true,
        "allowSyntheticDefaultImports": true,
        "strict": true,
        "forceConsistentCasingInFileNames": true,
        "noFallthroughCasesInSwitch": true,
        "module": "esnext",
        "moduleResolution": "node",
        "resolveJsonModule": true,
        "isolatedModules": true,
        "noEmit": true,
        "jsx": "react-jsx"
      },
      "include": [
        "src"
      ]
    }
    
    ```

# 7- antd 配置

* antd国内镜像地址：https://ant-design.gitee.io/index-cn

* 安装antd

  ```shell
  yarn add antd
  ```

* src->App.css

  ```css
  @import '~antd/dist/antd.css';
  ```

* `src->App.tsx`

  ```tsx
  import React from 'react';
  import {Button} from "antd";
  import "./App.css"
  
  function App() {
      return (
          <>
              <Button type="primary">Primary Button</Button>
              <Button>Default Button</Button>
              <Button type="dashed">Dashed Button</Button>
              <br />
              <Button type="text">Text Button</Button>
              <Button type="link">Link Button</Button>
          </>
      );
  }
  
  export default App;
  ```

# 8- antd高级配置

* 下载插件

  ```shell
  yarn add craco-antd
  ```

* craco.config.js

  ```js
  // 可以在该文件中对webpack进行二次配置。
  const path = require("path");
  // 1- 引入插件
  const CracoAntDesignPlugin = require('craco-antd');
  module.exports = {
      // 2- 配置插件
      plugins: [
          {
              plugin: CracoAntDesignPlugin,
              options: {
                  customizeTheme: {
                      '@primary-color': '#1DA57A',
                  },
              },
          },
      ],
      webpack:{
          // 别名处理：属性名即是别名：值是别名对应的目录
          alias:{
              "@":path.resolve(__dirname,"./src")
          }
      },
      devServer:{
          port:80,// 将默认3000端口号设置为80
          host:"zhangpeiyue.com",// 将localhost--->zhangpeiyue.com 指定主机名 ip  域名
      }
  }
  ```

  

# 9- 路由基本配置

* 下载路由插件库

  ```shell
  cnpm install react-router-dom
  ```

* 创建界面组件

  * 登陆界面：`src->pages->Login->index.tsx`

    ```tsx
    import React from 'react';
    
    function Login() {
        return (
            <div>登陆界面</div>
        );
    }
    
    export default Login;
    ```

    

  * 主页：src->pages->Index->index.tsx

    ```tsx
    import React from 'react';
    
    function Index() {
        return (
            <div>
                首页
            </div>
        );
    }
    
    export default Index;
    ```

  * 404界面：src->pages->NotFound->index.tsx

    ```tsx
    import { Button, Result } from 'antd';
    import React from 'react';
    import {useNavigate} from "react-router-dom";
    
    const NotFound = () => {
        const navigate = useNavigate();
        return (
            <Result
                status="404"
                title="404"
                subTitle="对不起，您找的页面不存在！"
                extra={<Button type="primary" onClick={()=>navigate("/")}>返回首页</Button>}
            />
        )
    };
    
    export default NotFound;
    ```

    

* 指定路由模式：`src->index.tsx`

  ```tsx
  import React from "react";
  import ReactDOM from "react-dom/client";
  import {
      BrowserRouter as Router,// 指定路由模式为history
  } from "react-router-dom";
  import App from "@/App";
  // 1- 指定挂载的位置
  const root = ReactDOM.createRoot(document.querySelector("#root") as Element);
  
  // 2- 将App呈现到界面中
  root.render((
      <Router>
          <App/>
      </Router>
  ));
  
  ```

* 配置路由：`src->App.tsx`

  ```tsx
  import React from 'react';
  import {Button} from "antd";
  import {
      Routes,
      Route
  } from "react-router-dom";
  import Index from "@/pages/Index";
  import Login from "@/pages/Login";
  import NotFound from "@/pages/NotFound";
  
  function App() {
      return (
          <Routes>
              <Route path={"/"} element={<Index/>}></Route>
              <Route path={"/login"} element={<Login/>}></Route>
              <Route path={"*"} element={<NotFound/>}></Route>
  
          </Routes>
      );
  }
  
  export default App;
  ```

# 10- 使用useRoutes

* src->App.tsx

  ```tsx
  import React from 'react';
  import {Button} from "antd";
  import {
      Routes,
      Route, useRoutes
  } from "react-router-dom";
  import Index from "@/pages/Index";
  import Login from "@/pages/Login";
  import NotFound from "@/pages/NotFound";
  
  function App() {
      const renderRouter = useRoutes([
          {
              path:"/",
              element:<Index/>
          },{
              path:"/login",
              element:<Login/>
          },{
              path:"*",
              element:<NotFound/>
          }
      ])
      return renderRouter;
  }
  
  export default App;
  ```

# 11- 路由配置抽离

* src->routes->index.tsx

  ```tsx
  import React from "react";
  import {useRoutes} from "react-router-dom";
  import Index from "@/pages/Index";
  import Login from "@/pages/Login";
  import NotFound from "@/pages/NotFound";
  
  // 1- 自定义hook函数
  // export default function useRenderRouter  (){
  //     return useRoutes([
  //         {
  //             path:"/",
  //             element:<Index/>
  //         },{
  //             path:"/login",
  //             element:<Login/>
  //         },{
  //             path:"*",
  //             element:<NotFound/>
  //         }
  //     ])
  // }
  
  // 2- 将hooks放置到匿名函数中导出
  export default function (){
      return useRoutes([
          {
              path:"/",
              element:<Index/>
          },{
              path:"/login",
              element:<Login/>
          },{
              path:"*",
              element:<NotFound/>
          }
      ])
  }
  
  ```

* src->App.tsx

  ```tsx
  import React from 'react';
  import useRenderRouter from "./routes";
  export default ()=> useRenderRouter();
  ```

# 12- 路由懒加载

* src->routes->index.tsx

  ```tsx
  import React,{
      lazy,
      Suspense
  } from "react";
  import {useRoutes} from "react-router-dom";
  const Index = lazy(()=>import("@/pages/Index"));
  const Login = lazy(()=>import("@/pages/Login"));
  const NotFound = lazy(()=>import("@/pages/NotFound"));
  
  export default function (){
      return useRoutes([
          {
              path:"/",
              element:(
                  <Suspense fallback={<h3>加载中……</h3>}>
                      <Index/>
                  </Suspense>
              )
          },{
              path:"/login",
              element:(
                  <Suspense fallback={<h3>加载中……</h3>}>
                      <Login/>
                  </Suspense>
              )
          },{
              path:"*",
              element:(
                  <Suspense fallback={<h3>加载中……</h3>}>
                      <NotFound/>
                  </Suspense>
              )
          }
      ])
  }
  
  ```

  





# 13- 路由懒加载优化一

> 将路由指定的元素进行封装

* src->routes->index.tsx

  ```tsx
  import React, {
      lazy,
      Suspense
  } from "react";
  import {useRoutes} from "react-router-dom";
  
  const lazyLoading = (comPath:string) => {
      const Com = lazy(()=>import("@/pages/"+comPath))
      return (
          <Suspense fallback={<h3>加载中……</h3>}>
              <Com/>
          </Suspense>
      )
  }
  export default function () {
      return useRoutes([
          {
              path: "/",
              element: lazyLoading("Index")
          }, {
              path: "/login",
              element:lazyLoading("Login")
          }, {
              path: "*",
              element:lazyLoading("NotFound")
          }
      ])
  }
  
  ```

* 将以上的方法抽离至utils->index.tsx中

  * src->utils->index.tsx

    ```tsx
    import React, {lazy, Suspense} from "react";
    
    export const lazyLoading = (comPath:string) => {
        const Com = lazy(()=>import("@/pages/"+comPath))
        return (
            <Suspense fallback={<h3>加载中……</h3>}>
                <Com/>
            </Suspense>
        )
    }
    ```

  * src->routes->index.tsx

    ```tsx
    import React, {
        lazy,
        Suspense
    } from "react";
    import {useRoutes} from "react-router-dom";
    import {lazyLoading} from "@/utils";
    
    export default function () {
        return useRoutes([
            {
                path: "/",
                element: lazyLoading("Index")
            }, {
                path: "/login",
                element: lazyLoading("Login")
            }, {
                path: "*",
                element: lazyLoading("NotFound")
            }
        ])
    }
    
    ```

    

# 14- 懒加载优化二

>  加载中抽离为一个组件

* src->App.less

  ```less
  #root{
      height:100%;
  }
  ```

* src->App.tsx

  ```tsx
  import React from 'react';
  import useRenderRouter from "./routes";
  // 引入样式
  import "./App.less";
  
  export default ()=> useRenderRouter();
  ```

* src->components->Loading->index.less

  ```less
  .example {
      //margin: 20px 0;
      height:100%;
      margin-bottom: 20px;
      padding: 30px 50px;
      text-align: center;
      background: rgba(0, 0, 0, 0.05);
      border-radius: 4px;
  }
  ```

  

* src->components->Loading->index.tsx

  ```tsx
  import React from 'react';
  import {Spin} from "antd";
  import "./index.less"
  function Index() {
      return (
          <div className="example">
              <Spin />
          </div>
      );
  }
  
  export default Index;
  ```

* src->utils->index.tsx

  ```tsx
  import React, {lazy, Suspense} from "react";
  import Loading from "@/components/Loading";
  export const lazyLoading = (comPath:string) => {
      const Com = lazy(()=>import("@/pages/"+comPath))
      return (
          <Suspense fallback={<Loading/>}>
              <Com/>
          </Suspense>
      )
  }
  ```

  



# 15- 路由拦截器

* 增加拦截未优化:不够灵活，无重用性。

  * src->pages->Index->index.tsx

    ```tsx
    import React from 'react';
    import {Navigate} from "react-router-dom";
    
    function Index() {
        // 增加一个拦截器，当用户未登陆（token为null）,跳转至登陆界面
        if (localStorage.getItem("token"))
            return (
                <div>
                    首页
                </div>
            );
        else
            return (
                <Navigate to={"/login"}></Navigate>
            )
    }
    
    export default Index;
    ```

* 自定义组件完成拦截功能

  * src->components->AuthComponent->index.tsx

    ```tsx
    import React,{ReactElement,FC} from 'react';
    import {
        Navigate
    } from "react-router-dom";
    
    // 1
    // function Index(props:any) {
        // if(localStorage.getItem("token")){
        //     return props.children;
        // }
        // return (
        //     <Navigate to={"/login"}></Navigate>
        // )
    
        // 以上代码优化
        // return localStorage.getItem("token")?props.children:<Navigate to={"/login"}></Navigate>
    // }
    
    // 2
    // const Index = (props:any)=>localStorage.getItem("token")?props.children:<Navigate to={"/login"}></Navigate>;
    
    
    // 3
    // type TProps = {
    //     children:React.ReactElement
    // }
    // const Index = (props:TProps)=>localStorage.getItem("token")?props.children:<Navigate to={"/login"}></Navigate>;
    
    
    // 4
    // type TProps = {
    //     children:React.ReactElement
    // }
    // const Index:React.FC<TProps> = (props)=>localStorage.getItem("token")?props.children:<Navigate to={"/login"}></Navigate>;
    
    // 5
    type TProps = {
        children:ReactElement
    }
    const Index:FC<TProps> = (props)=>localStorage.getItem("token")?props.children:<Navigate to={"/login"}></Navigate>;
    
    export default Index;
    ```

  * src->routes->index.tsx

    ```tsx
    import React, {
        lazy,
        Suspense
    } from "react";
    import {useRoutes} from "react-router-dom";
    import {lazyLoading} from "@/utils";
    import AuthComponent from "@/components/AuthComponent";
    
    export default function () {
        return useRoutes([
            {
                path: "/",
                element:(
                    <AuthComponent>
                        {
                            lazyLoading("Index")
                        }
                    </AuthComponent>
                )
            }, {
                path: "/login",
                element: lazyLoading("Login")
            }, {
                path: "*",
                element: lazyLoading("NotFound")
            }
        ])
    }
    
    ```


# 16- xxx.module.less

> 通过module.less解决样式冲突问题

* 支持module.less:src->react-app-env.d.ts

  ```ts
  /// <reference types="react-scripts"/>
  
  declare module '*.module.less' {
      const classes: { readonly [key: string]: string };
      export default classes;
  }
  
  type TOne = {
      userName:string,
      age:number
  }
  ```

  

* 将less文件以.module.less结尾：src->pages->Index->index.module.less

  ```less
  .cl{
      color:red;
      h3{
          color:blue;
      }
      .my{
          color:skyblue;
      }
      :global{
          .my{
              background: pink;
          }
      }
  
  }
  ```

* src->pages->Index->IndexHeader.module.less

  ```less
  .cl{
      color:green;
  }
  ```

  

* src->pages->Index->index.tsx

  ```tsx
  import React from 'react';
  import IndexHeader from "@/pages/Index/components/IndexHeader";
  import styles from  "./index.module.less";
  // ts
  function Index() {
      return (
          <div>
              <div className={styles.cl}>
                  <h3>首页</h3>
                  <div className={"my"}>div</div>
                  <div className={styles.my}>skyblue</div>
              </div>
              <IndexHeader/>
          </div>
      );
  }
  
  export default Index;
  ```

* src->pages->Index->components->IndexHeader.tsx

  ```tsx
  import React from 'react';
  import styles from "./indexHeader.module.less"
  function IndexHeader() {
      return (
          <div className={styles.cl}>
              我爱你中国，我亲爱的母亲，我为你流泪，也为你自豪
          </div>
      );
  }
  
  export default IndexHeader;
  ```

# 17- 完成登陆界面

* src->pages->Login->index.tsx

  ```tsx
  import React from 'react';
  import { LockOutlined, UserOutlined } from '@ant-design/icons';
  import { Button, Checkbox, Form, Input } from 'antd';
  import styles from "./index.module.less";
  const my:TOne = {
      userName:"lisi",
      age:12
  }
  const Login: React.FC = () => {
      const onFinish = (values: any) => {
          console.log('Received values of form: ', values);
      };
  
      return (
          <div className={styles.login}>
              <div>
                  <h1>尚医通管理系统</h1>
                  <Form
                      name="normal_login"
                      className="login-form"
                      initialValues={{ remember: true }}
                      onFinish={onFinish}
                  >
                      <Form.Item
                          name="username"
                          rules={[{ required: true, message: '请输入管理员账号!' }]}
                      >
                          <Input prefix={<UserOutlined className="site-form-item-icon" />} placeholder="管理员账号" />
                      </Form.Item>
                      <Form.Item
                          name="password"
                          rules={[{ required: true, message: '请输入管理员密码' }]}
                      >
                          <Input
                              prefix={<LockOutlined className="site-form-item-icon" />}
                              type="password"
                              placeholder="管理员密码"
                          />
                      </Form.Item>
  
                      <Form.Item>
                          <Button type="primary" htmlType="submit" className="login-form-button">
                              登陆
                          </Button>
                      </Form.Item>
                  </Form>
              </div>
  
          </div>
  
      );
  };
  
  export default Login;
  ```

  

* src->pages->Login->index.module.less

  ```less
  .login{
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      h1{
          text-align: center;
      }
      :global{
          .login-form {
              width: 400px;
              height: 300px;
          }
          .login-form-forgot {
              float: right;
          }
          .ant-col-rtl .login-form-forgot {
              float: left;
          }
          .login-form-button {
              width: 100%;
          }
      }
  }
  ```

# 18- 完成登陆功能

* 未分离版

  * 下载axios

    ```shell
    cnpm install axios
    ```

  * 项目根目录下：craco.config.js

    ```js
    // 可以在该文件中对webpack进行二次配置。
    const path = require("path");
    const CracoAntDesignPlugin = require('craco-antd');
    module.exports = {
        plugins: [
            {
                plugin: CracoAntDesignPlugin,
                options: {
                    customizeTheme: {
                        '@primary-color': '#1DA57A',
                    },
                },
            },
        ],
        webpack:{
            // 别名处理：属性名即是别名：值是别名对应的目录
            alias:{
                "@":path.resolve(__dirname,"./src")
            }
        },
        devServer:{
            port:80,// 将默认3000端口号设置为80
            host:"zhangpeiyue.com",// 将localhost--->zhangpeiyue.com 指定主机名 ip  域名
            proxy:{
                // /admin/auth/index/login
                // 以/admin开头即会使用该代理
                // "/admin":{
                //     target:"http://139.198.34.216:8230",// 请求服务地址
                //     changeOrigin:true,// 允许跨域
                // }
    
                // /auth/admin/auth/index/login
                // "/auth":{
                //     target:"http://139.198.34.216:8230",// 请求服务地址
                //     changeOrigin:true,// 允许跨域
                //     pathRewrite:{
                //         "^/auth":""
                //     }
                // }
    
                // /auth/index/login
                "/auth":{
                    target:"http://139.198.34.216:8230/admin",// 请求服务地址
                    changeOrigin:true,// 允许跨域
                }
    
            }
        }
    }
    ```

    

  * 使用：src->pages->Login->index.tsx

    ```tsx
    import React from 'react';
    import { LockOutlined, UserOutlined } from '@ant-design/icons';
    import {Button, Checkbox, Form, Input, message} from 'antd';
    // 1- 引入axios
    import axios from "axios";
    import styles from "./index.module.less";
    import {useNavigate} from "react-router-dom";
    const Login: React.FC = () => {
        const navigate = useNavigate();
        // 2- 发送请求
        const onFinish = async (values: any) => {
            // 当符合规则时，提交会运行。
            // 接口说明文档：
            // 请求方式：POST
            // 请求地址：http://139.198.34.216:8230/admin/auth/index/login
            // 发送参数：application/json {username:xxx,password:xxxx}
    
            // 以下允许跨域
            // const result = await axios.post("http://syt-api.atguigu.cn/admin/auth/index/login",values);
            // console.log(result.data);// 响应体数据
    
    
            const {data} = await axios.post("/auth/index/login",values);
            if(data.code === 200){
                message.success(data.message);
                // 保存token
                localStorage.setItem("token",data.data.token)
                // 跳转至主页
                navigate("/");
            }else{
                message.error(data.message);
            }
        };
    
        return (
            <div className={styles.login}>
                <div>
                    <h1>尚医通管理系统</h1>
                    <Form
                        name="normal_login"
                        className="login-form"
                        initialValues={{ remember: true }}
                        onFinish={onFinish}
                    >
                        <Form.Item
                            name="username"
                            rules={[{ required: true, message: '请输入管理员账号!' }]}
                        >
                            <Input prefix={<UserOutlined className="site-form-item-icon" />} placeholder="管理员账号" />
                        </Form.Item>
                        <Form.Item
                            name="password"
                            rules={[{ required: true, message: '请输入管理员密码' }]}
                        >
                            <Input
                                prefix={<LockOutlined className="site-form-item-icon" />}
                                type="password"
                                placeholder="管理员密码"
                            />
                        </Form.Item>
    
                        <Form.Item>
                            <Button type="primary" htmlType="submit" className="login-form-button">
                                登陆
                            </Button>
                        </Form.Item>
                    </Form>
                </div>
    
            </div>
    
        );
    };
    
    export default Login;
    ```

* 封装登陆功能

  * src->request->auth.ts

    ```ts
    // 与管理员相关的接口服务配置
    import axios from "axios";
    import {message} from "antd";
    const authRequest = axios.create({
        baseURL:"/auth"
    })
    // 响应拦截器
    authRequest.interceptors.response.use(res=>{
        if(res.data.code ===200) return res.data;
        message.error(res.data.message);
        // return Promise.reject(res);
        return new Promise(()=>{})
    })
    export default authRequest;
    ```

  * src->request->index.ts

    ```ts
    import authRequest from "@/request/auth";
    
    export {
        authRequest
    }
    ```

  * src->pages->Login->index.tsx

    ```tsx
    import React from 'react';
    import { LockOutlined, UserOutlined } from '@ant-design/icons';
    import {Button, Checkbox, Form, Input, message} from 'antd';
    import styles from "./index.module.less";
    import {useNavigate} from "react-router-dom";
    import {authRequest} from "@/request";
    const Login: React.FC = () => {
        const navigate = useNavigate();
        // 1- 优化
        const onFinish = async (values: any) => {
            const result:any = await authRequest.post("/index/login",values);
            message.success(result.message);
            // 保存token
            localStorage.setItem("token",result.data.token)
            // 跳转至主页
            navigate("/");
        };
    
        return (
            <div className={styles.login}>
                <div>
                    <h1>尚医通管理系统</h1>
                    <Form
                        name="normal_login"
                        className="login-form"
                        initialValues={{ remember: true }}
                        onFinish={onFinish}
                    >
                        <Form.Item
                            name="username"
                            rules={[{ required: true, message: '请输入管理员账号!' }]}
                        >
                            <Input prefix={<UserOutlined className="site-form-item-icon" />} placeholder="管理员账号" />
                        </Form.Item>
                        <Form.Item
                            name="password"
                            rules={[{ required: true, message: '请输入管理员密码' }]}
                        >
                            <Input
                                prefix={<LockOutlined className="site-form-item-icon" />}
                                type="password"
                                placeholder="管理员密码"
                            />
                        </Form.Item>
    
                        <Form.Item>
                            <Button type="primary" htmlType="submit" className="login-form-button">
                                登陆
                            </Button>
                        </Form.Item>
                    </Form>
                </div>
    
            </div>
    
        );
    };
    
    export default Login;
    ```

* 优化二

  * src->api->auth.ts

    ```ts
    import {authRequest} from "@/request";
    
    
    export const postLogin = (body:any)=>{
        return authRequest.post("/index/login",body);
    }
    ```

  * src->pages->Login->index.tsx

    ```tsx
    import React from 'react';
    import { LockOutlined, UserOutlined } from '@ant-design/icons';
    import {Button, Checkbox, Form, Input, message} from 'antd';
    import styles from "./index.module.less";
    import {useNavigate} from "react-router-dom";
    // 1- 引入
    import {postLogin} from "@/api/auth";
    const Login: React.FC = () => {
        const navigate = useNavigate();
        // 2- 调整方法
        const onFinish = async (values: any) => {
            const result:any = await postLogin(values);
            message.success(result.message);
            // 保存token
            localStorage.setItem("token",result.data.token)
            // 跳转至主页
            navigate("/");
        };
    
        return (
            <div className={styles.login}>
                <div>
                    <h1>尚医通管理系统</h1>
                    <Form
                        name="normal_login"
                        className="login-form"
                        initialValues={{ remember: true }}
                        onFinish={onFinish}
                    >
                        <Form.Item
                            name="username"
                            rules={[{ required: true, message: '请输入管理员账号!' }]}
                        >
                            <Input prefix={<UserOutlined className="site-form-item-icon" />} placeholder="管理员账号" />
                        </Form.Item>
                        <Form.Item
                            name="password"
                            rules={[{ required: true, message: '请输入管理员密码' }]}
                        >
                            <Input
                                prefix={<LockOutlined className="site-form-item-icon" />}
                                type="password"
                                placeholder="管理员密码"
                            />
                        </Form.Item>
    
                        <Form.Item>
                            <Button type="primary" htmlType="submit" className="login-form-button">
                                登陆
                            </Button>
                        </Form.Item>
                    </Form>
                </div>
    
            </div>
    
        );
    };
    
    export default Login;
    ```

# 19- 避免多次提交

* src->pages->Login->index.tsx

  ```tsx
  import React, {useState} from 'react';
  import { LockOutlined, UserOutlined } from '@ant-design/icons';
  import {Button, Checkbox, Form, Input, message} from 'antd';
  import styles from "./index.module.less";
  import {useNavigate} from "react-router-dom";
  import {postLogin} from "@/api/auth";
  const Login: React.FC = () => {
      const navigate = useNavigate();
      // 1- 定义状态：是否加载中
      const [loading,setLoading] = useState(false);
      const onFinish = async (values: any) => {
          // 2- 请求之前设置为true,有异常设置为false
          try{
              setLoading(true);// 正在加载中
              const result:any = await postLogin(values);
              message.success(result.message);
              // 保存token
              localStorage.setItem("token",result.data.token)
              // 跳转至主页
              navigate("/");
          }catch (err){
              setLoading(false);
          }
  
      };
  
      return (
          <div className={styles.login}>
              <div>
                  <h1>尚医通管理系统</h1>
                  <Form
                      name="normal_login"
                      className="login-form"
                      initialValues={{ remember: true }}
                      onFinish={onFinish}
                  >
                      <Form.Item
                          name="username"
                          rules={[{ required: true, message: '请输入管理员账号!' }]}
                      >
                          <Input prefix={<UserOutlined className="site-form-item-icon" />} placeholder="管理员账号" />
                      </Form.Item>
                      <Form.Item
                          name="password"
                          rules={[{ required: true, message: '请输入管理员密码' }]}
                      >
                          <Input
                              prefix={<LockOutlined className="site-form-item-icon" />}
                              type="password"
                              placeholder="管理员密码"
                          />
                      </Form.Item>
  
                      <Form.Item>
                          <Button loading={loading} type="primary" htmlType="submit" className="login-form-button">
                              登陆
                          </Button>
                      </Form.Item>
                  </Form>
              </div>
  
          </div>
  
      );
  };
  
  export default Login;
  ```

# 20- 创建redux

* 下载

  ```shell
  cnpm install react-redux @reduxjs/toolkit
  ```

* src->store->slices->auth.ts

  ```ts
  import {
      createSlice
  } from "@reduxjs/toolkit";
  import {useSelector} from "react-redux";
  
  const authSlice = createSlice({
      name:"auth",
      initialState:{
          loading:false
      },
      reducers:{
          changeLoading(state,{payload}){
              state.loading = payload;
          }
      }
  })
  export const {changeLoading} = authSlice.actions;
  export const useSelectorAuth = ()=>useSelector((state:any)=>state.auth);
  export default authSlice.reducer;
  ```

* src->store->index.ts

  ```ts
  import {
      configureStore
  } from "@reduxjs/toolkit";
  import auth from "./slices/auth";
  export default configureStore({
      reducer:{
          auth
      }
  })
  ```

* 完成登陆：src->pages->Login->index.tsx

  ```tsx
  import React, {useState} from 'react';
  import { LockOutlined, UserOutlined } from '@ant-design/icons';
  import {Button, Checkbox, Form, Input, message} from 'antd';
  import styles from "./index.module.less";
  import {useNavigate} from "react-router-dom";
  import store from "@/store";
  import {postLogin} from "@/api/auth";
  import {useSelector} from "react-redux";
  import {changeLoading, useSelectorAuth} from "@/store/slices/auth";
  import {authRequest} from "@/request";
  const Login: React.FC = () => {
      const navigate = useNavigate();
      // 获取数据状态1
      // console.log(store.getState());// {auth:{loading:false}}
  
      // 获取数据状态2: useSelector接收一个回调函数，回调函数返回的值即是useSelector返回的值
      //             回调函数接收的参数即是数据状态
      // const result =  useSelector(state=>{
      //     console.log(state);// {auth:{loading:false}}
      // });
      // console.log(result);//
  
  
      // 获取loading
      // type TAuth = {
      //     auth:{
      //         loading:boolean
      //     }
      // }
      // const {loading} = useSelector((state:TAuth)=>state.auth);
      // console.log(loading);
  
      // 获取数据状态3：封装方法
      const {loading} = useSelectorAuth();
      console.log(loading);
  
  
      return (
          <div className={styles.login}>
              <div>
                  <h1>尚医通管理系统</h1>
                  <Form
                      name="normal_login"
                      className="login-form"
                      initialValues={{ remember: true }}
                      onFinish={async (values:any)=>{
                          try{
                              store.dispatch(changeLoading(true));
                              const result:any = await postLogin(values);
                              message.success(result.message);
                              localStorage.setItem("token",result.data.token);
                              store.dispatch(changeLoading(false));
                              navigate("/");
                          }catch (err){
                              store.dispatch(changeLoading(false));
                          }
  
                      }}
                  >
                      <Form.Item
                          name="username"
                          rules={[{ required: true, message: '请输入管理员账号!' }]}
                      >
                          <Input prefix={<UserOutlined className="site-form-item-icon" />} placeholder="管理员账号" />
                      </Form.Item>
                      <Form.Item
                          name="password"
                          rules={[{ required: true, message: '请输入管理员密码' }]}
                      >
                          <Input
                              prefix={<LockOutlined className="site-form-item-icon" />}
                              type="password"
                              placeholder="管理员密码"
                          />
                      </Form.Item>
  
                      <Form.Item>
                          <Button loading={loading}  type="primary" htmlType="submit" className="login-form-button">
                              登陆
                          </Button>
                      </Form.Item>
                  </Form>
              </div>
  
          </div>
  
      );
  };
  
  export default Login;
  ```

* src->index.tsx

  ```tsx
  import React from "react";
  import ReactDOM from "react-dom/client";
  import {
      BrowserRouter as Router
  } from "react-router-dom";
  import store from "./store";
  import {
      Provider
  } from "react-redux";
  import App from "@/App";
  // 1- 指定挂载的位置
  const root = ReactDOM.createRoot(document.querySelector("#root") as Element);
  
  // 2- 将App呈现到界面中
  root.render((
      <Provider store={store}>
          <Router>
              <App/>
          </Router>
      </Provider>
  
  ));
  
  ```

  





# 21- dispatch的使用

* src->store->slices->auth.ts

  ```tsx
  import {
      createSlice,
      createAsyncThunk
  } from "@reduxjs/toolkit";
  import {useSelector} from "react-redux";
  import {postLogin} from "@/api/auth";
  import {message} from "antd";
  
  const authSlice = createSlice({
      name:"auth",
      initialState:{
          loading:false,
          token:localStorage.token
      },
      reducers:{
          changeLoading(state,action){
              state.loading = action.payload;
          },
          upToken(state,{payload}){
              // localStorage.setItem("token",xxx);
              // localStorage.token=xxx;
              // localStorage["token"]=xxx;
              state.token = localStorage.token =  payload;
          }
      },
      extraReducers(builder){
          builder.addCase(postLoginAsync2.fulfilled,(state,{payload})=>{
              // console.log("postLoginAsync2.fulfilled",payload);
              state.loading = false;
              state.token = localStorage.token = payload.result.data.token;
              message.success((payload as any).result.message);
              payload.navigate("/");
  
  
          }).addCase(postLoginAsync2.pending,(state,{payload})=>{
              state.loading = true;
              // console.log("postLoginAsync2.pending",payload);
          }).addCase(postLoginAsync2.rejected,(state,{payload})=>{
              // console.log("postLoginAsync2.rejected",payload);
              state.loading = false;
          })
      }
  })
  // 柯里化
  export const postLoginAsync = function(options:any){
      return  async (dispatch:any,getState:any)=>{
          console.log(getState())// 获取redux仓库中的数据状态
          try{
              dispatch(changeLoading(true));
              const result:any = await postLogin(options.values);
              message.success(result.message);
              dispatch(changeLoading(false));
              dispatch(upToken(result.data.token));
              options.navigate("/");
          }catch (err){
              dispatch(changeLoading(false));
          }
      }
  }
  // 扩展
  export const postLoginAsync2 = createAsyncThunk("postLoginAsync2",async function(options:any){
      try{
          const result = await postLogin(options.values);
          return {
              result,
              navigate:options.navigate
          };
      }catch (err){
          return Promise.reject(err);
      }
  
  })
  export const {changeLoading,upToken} = authSlice.actions;
  export const useSelectorAuth = ()=>useSelector((state:any)=>state.auth);
  export default authSlice.reducer;
  ```

* src->hooks->index.ts

  ```ts
  import store from "@/store";
  import {useDispatch} from "react-redux";
  
  export const useAppDispatch = ()=>{
      type TDispatch = typeof store.dispatch;
      return useDispatch<TDispatch>();
  }
  ```

* src->pages->Login->index.tsx

  ```tsx
  import React, {useState} from 'react';
  import { LockOutlined, UserOutlined } from '@ant-design/icons';
  import {Button, Checkbox, Form, Input, message} from 'antd';
  import styles from "./index.module.less";
  import {useNavigate} from "react-router-dom";
  import store from "@/store";
  import {postLogin} from "@/api/auth";
  import {useDispatch, useSelector} from "react-redux";
  import {changeLoading, postLoginAsync, postLoginAsync2, upToken, useSelectorAuth} from "@/store/slices/auth";
  import {authRequest} from "@/request";
  import {useAppDispatch} from "@/hooks";
  const Login: React.FC = () => {
      const navigate = useNavigate();
      // 获取数据状态1
      // console.log(store.getState());// {auth:{loading:false}}
  
      // 获取数据状态2: useSelector接收一个回调函数，回调函数返回的值即是useSelector返回的值
      //             回调函数接收的参数即是数据状态
      // const result =  useSelector(state=>{
      //     console.log(state);// {auth:{loading:false}}
      // });
      // console.log(result);//
  
  
      // 获取loading
      // type TAuth = {
      //     auth:{
      //         loading:boolean
      //     }
      // }
      // const {loading} = useSelector((state:TAuth)=>state.auth);
      // console.log(loading);
  
      // 获取数据状态3：封装方法
      const {loading} = useSelectorAuth();
      console.log(loading);
  
      // 1- 通过useDispatch生成dispatch
      // type TDispatch = typeof store.dispatch;
      // const dispatch = useDispatch<TDispatch>();
  
      // 2- 将以上代码封装成自定义的hooks
      const dispatch = useAppDispatch();
      return (
          <div className={styles.login}>
              <div>
                  <h1>尚医通管理系统</h1>
                  <Form
                      name="normal_login"
                      className="login-form"
                      initialValues={{ remember: true }}
                      onFinish={async (values:any)=>{
                          // dispatch接收的参数可以称为action.
                          // action分为同步action(对象),异步action（函数）
                          // 1
                          // store.dispatch(async function(dispatch,getState){
                          //     console.log(getState())// 获取redux仓库中的数据状态
                          //     try{
                          //         dispatch(changeLoading(true));
                          //         const result:any = await postLogin(values);
                          //         message.success(result.message);
                          //         dispatch(changeLoading(false));
                          //         dispatch(upToken(result.data.token));
                          //         navigate("/")
                          //     }catch (err){
                          //         dispatch(changeLoading(false));
                          //     }
                          //
                          // })
  
                          // 2
                          // async function postLoginAsync(dispatch:any,getState:any){
                          //     console.log(getState())// 获取redux仓库中的数据状态
                          //     try{
                          //         dispatch(changeLoading(true));
                          //         const result:any = await postLogin(values);
                          //         message.success(result.message);
                          //         dispatch(changeLoading(false));
                          //         dispatch(upToken(result.data.token));
                          //         navigate("/")
                          //     }catch (err){
                          //         dispatch(changeLoading(false));
                          //     }
                          //
                          // }
                          // store.dispatch(postLoginAsync)
  
  
                          // 3
                          // await store.dispatch(postLoginAsync({
                          //     values,
                          //     navigate
                          // }));
  
                          // 4
                          // await dispatch(postLoginAsync({values,navigate}));
  
  
                          // 5- 扩展
                          await dispatch(postLoginAsync2({values,navigate}));
  
                      }}
                  >
                      <Form.Item
                          name="username"
                          rules={[{ required: true, message: '请输入管理员账号!' }]}
                      >
                          <Input prefix={<UserOutlined className="site-form-item-icon" />} placeholder="管理员账号" />
                      </Form.Item>
                      <Form.Item
                          name="password"
                          rules={[{ required: true, message: '请输入管理员密码' }]}
                      >
                          <Input
                              prefix={<LockOutlined className="site-form-item-icon" />}
                              type="password"
                              placeholder="管理员密码"
                          />
                      </Form.Item>
  
                      <Form.Item>
                          <Button loading={loading}  type="primary" htmlType="submit" className="login-form-button">
                              登陆
                          </Button>
                      </Form.Item>
                  </Form>
              </div>
  
          </div>
  
      );
  };
  
  export default Login;
  ```

# 22- 主页界面设计

* src->pages->Index->index.less

  ```less
  .logo {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 40px;
      margin: 16px;
      white-space: nowrap;
      img{
          height: 30px;
      }
      span{
          color:white;
          font-size: 16px;
          padding-left: 5px;
      }
      //background: rgba(255, 255, 255, 0.3);
  }
  .ant-layout-header{
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding:0 10px !important;
  }
  .ant-layout-footer {
      padding: 10px 50px;
  }
  .site-layout .site-layout-background {
      background: #fff;
  }
  ```

* src->pages->Index->index.tsx

  ```tsx
  import React, { useState } from 'react';
  import {
      HomeOutlined,
      DatabaseOutlined,
      LoginOutlined
  } from '@ant-design/icons';
  import type { MenuProps } from 'antd';
  import { Breadcrumb, Layout, Menu,Dropdown,Space,Avatar } from 'antd';
  import "./index.less";
  import {Link} from "react-router-dom";
  const { Header, Content, Footer, Sider } = Layout;
  
  type MenuItem = Required<MenuProps>['items'][number];
  
  function getItem(
      label: React.ReactNode,
      key: React.Key,
      icon?: React.ReactNode,
      children?: MenuItem[],
  ): MenuItem {
      return {
          key,
          icon,
          children,
          label,
      } as MenuItem;
  }
  
  const items: MenuItem[] = [
      getItem('主页', '1', <HomeOutlined />),
      getItem('数据管理', 'sub1', <DatabaseOutlined />, [
          getItem('数据字典', '3')
      ])
  ];
  const menu = (
      <Menu
          items={[
              {
                  key: '1',
                  label: (
                      <Link to={"/"}>返回首页</Link>
                  ),
                  icon: <HomeOutlined />
              },
              {
                  key: '2',
                  label: (
                      <Link to={"/"}>退出登陆</Link>
                  ),
                  icon: <LoginOutlined />
              },
          ]}
      />
  );
  const Index: React.FC = () => {
      // 是否收起
      const [collapsed, setCollapsed] = useState(false);
  
      return (
          <Layout style={{ minHeight: '100vh' }}>
              <Sider collapsible collapsed={collapsed} onCollapse={value => setCollapsed(value)}>
                  <div className="logo">
                      <img src={require("@/assets/img/logo.png")} alt=""/>
                      <span style={{display:collapsed?"none":"inline-block"}}>尚医通管理系统</span>
                  </div>
                  <Menu theme="dark" defaultSelectedKeys={['1']} mode="inline" items={items} />
              </Sider>
              <Layout className="site-layout">
                  <Header className="site-layout-background" style={{ padding: 0 }} >
                      <Breadcrumb style={{ margin: '16px 0' }}>
                          <Breadcrumb.Item>User</Breadcrumb.Item>
                          <Breadcrumb.Item>Bill</Breadcrumb.Item>
                      </Breadcrumb>
  
  
                      <Space>
                          <span>欢迎回来xxxxn！</span>
                          <Dropdown overlay={menu}>
                              <a onClick={e => e.preventDefault()}>
                                  <Avatar src="https://joeschmoe.io/api/v1/random" />
                              </a>
                          </Dropdown>
                      </Space>
  
                  </Header>
                  <Content style={{ margin: '5px' }}>
  
                      <div className="site-layout-background" style={{ padding: 24, height:"100%" }}>
                          Bill is a cat.
                      </div>
                  </Content>
                  <Footer style={{ textAlign: 'center' }}>Ant Design ©2018 Created by Ant UED</Footer>
              </Layout>
          </Layout>
      );
  };
  
  export default Index;
  ```

  



# 23- 主页界面拆分

* src->pages->Index->components->IndexHeader.tsx

  ```tsx
  import React from 'react';
  import {Avatar, Breadcrumb, Dropdown, Space, Layout, Menu} from "antd";
  import {Link} from "react-router-dom";
  import {HomeOutlined, LoginOutlined} from "@ant-design/icons";
  
  const menu = (
      <Menu
          items={[
              {
                  key: '1',
                  label: (
                      <Link to={"/"}>返回首页</Link>
                  ),
                  icon: <HomeOutlined />
              },
              {
                  key: '2',
                  label: (
                      <Link to={"/"}>退出登陆</Link>
                  ),
                  icon: <LoginOutlined />
              },
          ]}
      />
  );
  function IndexHeader() {
      return (
          <Layout.Header className="site-layout-background" style={{ padding: 0 }} >
              <Breadcrumb style={{ margin: '16px 0' }}>
                  <Breadcrumb.Item>User</Breadcrumb.Item>
                  <Breadcrumb.Item>Bill</Breadcrumb.Item>
              </Breadcrumb>
  
  
              <Space>
                  <span>欢迎回来xxxxn！</span>
                  <Dropdown overlay={menu}>
                      <a onClick={e => e.preventDefault()}>
                          <Avatar src="https://joeschmoe.io/api/v1/random" />
                      </a>
                  </Dropdown>
              </Space>
  
          </Layout.Header>
      );
  }
  
  export default IndexHeader;
  ```

  

* src->pages->Index->components->IndexSider.tsx

  ```tsx
  import React, {useState} from 'react';
  import {Menu, Layout, MenuProps} from "antd";
  import {DatabaseOutlined, HomeOutlined} from "@ant-design/icons";
  
  type MenuItem = Required<MenuProps>['items'][number];
  
  function getItem(
      label: React.ReactNode,
      key: React.Key,
      icon?: React.ReactNode,
      children?: MenuItem[],
  ): MenuItem {
      return {
          key,
          icon,
          children,
          label,
      } as MenuItem;
  }
  
  const items: MenuItem[] = [
      getItem('主页', '1', <HomeOutlined />),
      getItem('数据管理', 'sub1', <DatabaseOutlined />, [
          getItem('数据字典', '3')
      ])
  ];
  function IndexSider() {
      const [collapsed,setCollapsed] = useState(false);
      return (
          <Layout.Sider collapsible collapsed={collapsed} onCollapse={value => setCollapsed(value)}>
              <div className="logo">
                  <img src={require("@/assets/img/logo.png")} alt=""/>
                  <span style={{display:collapsed?"none":"inline-block"}}>尚医通管理系统</span>
              </div>
              <Menu theme="dark" defaultSelectedKeys={['1']} mode="inline" items={items} />
          </Layout.Sider>
      );
  }
  
  export default IndexSider;
  ```

  

* src->pages->Index->components->IndexContent.tsx

  ```tsx
  import React from 'react';
  import {Layout} from "antd";
  
  function IndexContent() {
      return (
          <Layout.Content style={{ margin: '5px' }}>
  
              <div className="site-layout-background" style={{ padding: 24, height:"100%" }}>
                  Bill is a cat.
              </div>
          </Layout.Content>
      );
  }
  
  export default IndexContent;
  ```

  

* src->pages->Index->components->IndexFooter.tsx

  ```tsx
  import React from 'react';
  import {Layout} from "antd";
  
  function IndexFooter() {
      return (
          <Layout.Footer style={{ textAlign: 'center' }}>Ant Design ©2022 Created by 220525</Layout.Footer>
      );
  }
  
  export default IndexFooter;
  ```

  

* src->pages->Index->index.tsx

  ```tsx
  import React  from 'react';
  import { Layout } from 'antd';
  import IndexSider from "@/pages/Index/components/IndexSider";
  import IndexHeader from "@/pages/Index/components/IndexHeader";
  import "./index.less";
  import IndexContent from "@/pages/Index/components/IndexContent";
  import IndexFooter from "@/pages/Index/components/IndexFooter";
  
  const Index: React.FC = () => {
  
      return (
          <Layout style={{ minHeight: '100vh' }}>
              <IndexSider/>
              <Layout className="site-layout">
                  <IndexHeader/>
                  <IndexContent/>
                  <IndexFooter/>
              </Layout>
          </Layout>
      );
  };
  
  export default Index;
  ```

  





# 24- 完成退出登陆

* src->request->auth.ts:增加请求拦截

  ```tsx
  // 请求拦截
  authRequest.interceptors.request.use((config:any)=>{
      if(localStorage.getItem("token")){
          config.headers.token = localStorage.getItem("token");
      }
      return config;
  })
  ```

  

* src->api->auth.ts

  ```ts
  // 退出登陆 /admin/auth/index/logout
  export const postLogOut = ()=>{
      return authRequest.post("/index/logout");
  }
  ```

  

* src->store->slices->auth.ts

  ```ts
  import {
      createSlice,
      createAsyncThunk
  } from "@reduxjs/toolkit";
  import {useSelector} from "react-redux";
  import {postLogin, postLogOut} from "@/api/auth";
  import {message} from "antd";
  
  const authSlice = createSlice({
      name:"auth",
      initialState:{
          loading:false,
          token:localStorage.token
      },
      reducers:{
          changeLoading(state,action){
              state.loading = action.payload;
          },
          upToken(state,{payload}){
              // localStorage.setItem("token",xxx);
              // localStorage.token=xxx;
              // localStorage["token"]=xxx;
              state.token = localStorage.token =  payload;
          },
          delToken(state){
              // state.token = localStorage.token = null;
              localStorage.clear();
              state.token = null;
          }
      },
      extraReducers(builder){
          builder.addCase(postLoginAsync2.fulfilled,(state,{payload})=>{
              // console.log("postLoginAsync2.fulfilled",payload);
              state.loading = false;
              state.token = localStorage.token = payload.result.data.token;
              message.success((payload as any).result.message);
              payload.navigate("/");
  
  
          }).addCase(postLoginAsync2.pending,(state,{payload})=>{
              state.loading = true;
              // console.log("postLoginAsync2.pending",payload);
          }).addCase(postLoginAsync2.rejected,(state,{payload})=>{
              // console.log("postLoginAsync2.rejected",payload);
              state.loading = false;
          })
      }
  })
  // 柯里化
  export const postLoginAsync = function(options:any){
      return  async (dispatch:any,getState:any)=>{
          console.log(getState())// 获取redux仓库中的数据状态
          try{
              dispatch(changeLoading(true));
              const result:any = await postLogin(options.values);
              message.success(result.message);
              dispatch(changeLoading(false));
              dispatch(upToken(result.data.token));
              options.navigate("/");
          }catch (err){
              dispatch(changeLoading(false));
          }
      }
  }
  // 扩展
  export const postLoginAsync2 = createAsyncThunk("postLoginAsync2",async function(options:any){
      try{
          const result = await postLogin(options.values);
          return {
              result,
              navigate:options.navigate
          };
      }catch (err){
          return Promise.reject(err);
      }
  
  })
  // 退出登陆
  export const postLogOutAsync = function(){
      return async (dispatch:any)=>{
          await postLogOut();
          dispatch(delToken());
          message.success("退出成功");
  
      }
  }
  export const {changeLoading,upToken,delToken} = authSlice.actions;
  export const useSelectorAuth = ()=>useSelector((state:any)=>state.auth);
  export default authSlice.reducer;
  ```

  

* src->pages->Index->components->IndexHeader.tsx

  ```tsx
  import React from 'react';
  import {Avatar, Breadcrumb, Dropdown, Space, Layout, Menu} from "antd";
  import {Link, useNavigate} from "react-router-dom";
  import {HomeOutlined, LoginOutlined} from "@ant-design/icons";
  import {useAppDispatch} from "@/hooks";
  import {postLogOutAsync} from "@/store/slices/auth";
  
  
  function IndexHeader() {
      const dispatch = useAppDispatch();
      const navigate = useNavigate();
      const menu = (
          <Menu
              items={[
                  {
                      key: '1',
                      label: (
                          <Link to={"/"}>返回首页</Link>
                      ),
                      icon: <HomeOutlined />
                  },
                  {
                      key: '2',
                      label: (
                          <a onClick={async e=>{
                              e.preventDefault();
                              await dispatch(postLogOutAsync());
                              navigate("/login");
                          }}>退出登陆</a>
                      ),
                      icon: <LoginOutlined />
                  },
              ]}
          />
      );
      return (
          <Layout.Header className="site-layout-background" style={{ padding: 0 }} >
              <Breadcrumb style={{ margin: '16px 0' }}>
                  <Breadcrumb.Item>User</Breadcrumb.Item>
                  <Breadcrumb.Item>Bill</Breadcrumb.Item>
              </Breadcrumb>
  
  
              <Space>
                  <span>欢迎回来xxxxn！</span>
                  <Dropdown overlay={menu}>
                      <a onClick={e => e.preventDefault()}>
                          <Avatar src="https://joeschmoe.io/api/v1/random" />
                      </a>
                  </Dropdown>
              </Space>
  
          </Layout.Header>
      );
  }
  
  export default IndexHeader;
  ```

  





# 25- 完成个人详情调用

* src->api->auth.ts

  ```ts
  // 获取账号信息 /admin/auth/index/info
  export const getInfo = ()=>{
      return authRequest.get("/index/info");
  }
  ```

* src->store->slices->auth.ts

  ```ts
  import {
      createSlice,
      createAsyncThunk
  } from "@reduxjs/toolkit";
  import {useSelector} from "react-redux";
  import {getInfo, postLogin, postLogOut} from "@/api/auth";
  import {message} from "antd";
  
  const authSlice = createSlice({
      name:"auth",
      initialState:{
          loading:false,
          token:localStorage.token,
          info:{
  
          }
      },
      reducers:{
          changeLoading(state,action){
              state.loading = action.payload;
          },
          upToken(state,{payload}){
              // localStorage.setItem("token",xxx);
              // localStorage.token=xxx;
              // localStorage["token"]=xxx;
              state.token = localStorage.token =  payload;
          },
          delToken(state){
              // state.token = localStorage.token = null;
              localStorage.clear();
              state.token = null;
          },
          upInfo(state,{payload}){
              state.info = payload;
          }
      },
      extraReducers(builder){
          builder.addCase(postLoginAsync2.fulfilled,(state,{payload})=>{
              // console.log("postLoginAsync2.fulfilled",payload);
              state.loading = false;
              state.token = localStorage.token = payload.result.data.token;
              message.success((payload as any).result.message);
              // payload.navigate("/");
  
  
          }).addCase(postLoginAsync2.pending,(state,{payload})=>{
              state.loading = true;
              // console.log("postLoginAsync2.pending",payload);
          }).addCase(postLoginAsync2.rejected,(state,{payload})=>{
              // console.log("postLoginAsync2.rejected",payload);
              state.loading = false;
          })
      }
  })
  // 柯里化
  export const postLoginAsync = function(options:any){
      return  async (dispatch:any,getState:any)=>{
          console.log(getState())// 获取redux仓库中的数据状态
          try{
              dispatch(changeLoading(true));
              const result:any = await postLogin(options.values);
              message.success(result.message);
              dispatch(changeLoading(false));
              dispatch(upToken(result.data.token));
              options.navigate("/");
          }catch (err){
              dispatch(changeLoading(false));
          }
      }
  }
  // 扩展
  export const postLoginAsync2 = createAsyncThunk("postLoginAsync2",async function(options:any){
      try{
          const result = await postLogin(options.values);
  
          return {
              result,
              // navigate:options.navigate
          };
      }catch (err){
          return Promise.reject(err);
      }
  
  })
  // 退出登陆
  export const postLogOutAsync = function(){
      return async (dispatch:any)=>{
          await postLogOut();
          dispatch(delToken());
          message.success("退出成功");
  
      }
  }
  // 获取账号信息
  export const getInfoAsync = function(){
      return async (dispatch:any)=>{
          const result = await getInfo();
          console.log(result);
          dispatch(upInfo({
              name:result.data.name,
              avatar:result.data.avatar
          }))
      }
  }
  export const {changeLoading,upToken,delToken,upInfo} = authSlice.actions;
  export const useSelectorAuth = ()=>useSelector((state:any)=>state.auth);
  export default authSlice.reducer;
  ```

  

* src->pages->Index->index.ts

  ```ts
  import React, {useEffect} from 'react';
  import { Layout } from 'antd';
  import IndexSider from "@/pages/Index/components/IndexSider";
  import IndexHeader from "@/pages/Index/components/IndexHeader";
  import "./index.less";
  import IndexContent from "@/pages/Index/components/IndexContent";
  import IndexFooter from "@/pages/Index/components/IndexFooter";
  import {getInfoAsync} from "@/store/slices/auth";
  import {useAppDispatch} from "@/hooks";
  
  const Index: React.FC = () => {
      const dispatch = useAppDispatch();
      useEffect(()=>{
          (async ()=>{
              await dispatch(getInfoAsync())
          })();
  
          // dispatch(getInfoAsync())
      },[])
      return (
          <Layout style={{ minHeight: '100vh' }}>
              <IndexSider/>
              <Layout className="site-layout">
                  <IndexHeader/>
                  <IndexContent/>
                  <IndexFooter/>
              </Layout>
          </Layout>
      );
  };
  
  export default Index;
  ```

* src->pages->Index->components->IndexContent.tsx

  ```tsx
  import React from 'react';
  import {Layout} from "antd";
  import {useSelectorAuth} from "@/store/slices/auth";
  
  function IndexContent() {
      const {info} = useSelectorAuth();
      return (
          <Layout.Content style={{ margin: '5px' }}>
  
              <div className="site-layout-background" style={{ padding: 24, height:"100%" }}>
                  <p>用户名：{info.name}</p>
                  <img src={info.avatar} alt=""/>
              </div>
          </Layout.Content>
      );
  }
  
  export default IndexContent;
  ```

* src->pages->Index->components->IndexHeader.tsx

  ```tsx
  import React from 'react';
  import {Avatar, Breadcrumb, Dropdown, Space, Layout, Menu} from "antd";
  import {Link, useNavigate} from "react-router-dom";
  import {HomeOutlined, LoginOutlined} from "@ant-design/icons";
  import {useAppDispatch} from "@/hooks";
  import {postLogOutAsync, useSelectorAuth} from "@/store/slices/auth";
  
  
  function IndexHeader() {
      const dispatch = useAppDispatch();
      const navigate = useNavigate();
      const {info} = useSelectorAuth();
      const menu = (
          <Menu
              items={[
                  {
                      key: '1',
                      label: (
                          <Link to={"/"}>返回首页</Link>
                      ),
                      icon: <HomeOutlined />
                  },
                  {
                      key: '2',
                      label: (
                          <a onClick={async e=>{
                              e.preventDefault();
                              await dispatch(postLogOutAsync());
                              navigate("/login");
                          }}>退出登陆</a>
                      ),
                      icon: <LoginOutlined />
                  },
              ]}
          />
      );
      return (
          <Layout.Header className="site-layout-background" style={{ padding: 0 }} >
              <Breadcrumb style={{ margin: '16px 0' }}>
                  <Breadcrumb.Item>User</Breadcrumb.Item>
                  <Breadcrumb.Item>Bill</Breadcrumb.Item>
              </Breadcrumb>
  
  
              <Space>
                  <span>欢迎回来{info.name}！</span>
                  <Dropdown overlay={menu}>
                      <a onClick={e => e.preventDefault()}>
                          <Avatar src={info.avatar} />
                      </a>
                  </Dropdown>
              </Space>
  
          </Layout.Header>
      );
  }
  
  export default IndexHeader;
  ```

  



































* 前台项目地址：http://syt.atguigu.cn/

* 接口文档：http://139.198.34.216:8230/doc.html#/home

* 接口baseurl:

  * http://syt-api.atguigu.cn

* 数据字典接口：http://139.198.34.216:8202/swagger-ui.html

  医院接口地址 http://139.198.34.216:8201/swagger-ui.html

  用户接口：http://139.198.34.216:8203/swagger-ui.html

  订单接口：http://139.198.34.216:8206/swagger-ui.html

